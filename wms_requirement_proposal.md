# WMS路径优化功能需求提案

## 🎯 需求背景
通过对历史拣货数据的分析，发现当前路径规划存在大量重访和低效路径问题，影响拣货效率。

## 📊 需求优先级矩阵

| 需求类型 | 优先级 | 实现难度 | 预期收益 |
|---------|-------|---------|---------|
| 实时路径异常监控 | P0 | 中 | 高 |
| 路径质量评分系统 | P0 | 低 | 高 |
| 智能路径优化算法 | P1 | 高 | 极高 |
| 货位布局优化建议 | P2 | 中 | 中 |

---

## 🚨 P0需求：实时监控与告警

### 需求1.1: 路径质量实时监控看板
**需求描述**:
在WMS管理界面增加实时监控面板，显示当前正在进行的拣货波次的路径质量指标。

**功能要点**:
```
1. 实时指标显示：
   - Aisle Revisit次数（阈值：>2次告警）
   - Shelf Revisit次数（阈值：>3次告警）
   - Slot Revisit次数（阈值：>1次告警）
   - 路径效率得分（0-100分）

2. 异常波次自动标记：
   - 🔴 红色：严重低效（得分<60）
   - 🟡 黄色：需优化（得分60-80）
   - 🟢 绿色：正常（得分>80）

3. 历史趋势图：
   - 近7天路径质量趋势
   - 异常波次占比
```

**数据接口需求**:
```javascript
// API 1: 获取波次路径质量
GET /api/wave/{waveId}/quality-metrics
Response: {
  "waveId": "W20251203001",
  "qualityScore": 65,
  "revisits": {
    "aisle": 3,
    "shelf": 5,
    "slot": 2
  },
  "distance": {
    "actual": 450,
    "optimal": 320,
    "efficiency": 71.1
  },
  "alerts": [
    {
      "type": "AISLE_REVISIT",
      "severity": "HIGH",
      "detail": "Aisle A01 visited 3 times",
      "suggestedFix": "Consolidate picks in Aisle A01"
    }
  ]
}

// API 2: 获取实时监控数据流
WebSocket: ws://wms-server/monitor/picking-quality
Message: {
  "timestamp": "2025-12-03T10:30:45Z",
  "activeWaves": 12,
  "avgQualityScore": 78.5,
  "alertCount": 3
}
```

---

### 需求1.2: 路径异常自动告警
**需求描述**:
当检测到路径异常时，实时通知相关人员并记录。

**告警规则**:
```yaml
Rule 1: 通道重访告警
  条件: Aisle Revisit >= 2
  动作:
    - 实时推送通知给拣货主管
    - 记录异常日志
    - 标记波次为"待优化"

Rule 2: 路径回溯告警
  条件: 检测到位置序号倒退（如 Loc_050 → Loc_010）
  动作:
    - 提示拣货员检查顺序
    - 记录可能的人为错误

Rule 3: 效率骤降告警
  条件: 当前波次效率比平均值低30%
  动作:
    - 触发调度系统审查
    - 自动生成问题分析报告
```

**通知渠道**:
- [ ] WMS系统内推送
- [ ] 企业微信/钉钉机器人
- [ ] 邮件摘要（每日汇总）
- [ ] 手持终端震动提示（给拣货员）

---

## 🎯 P0需求：路径质量评分系统

### 需求2.1: 路径质量评分算法
**需求描述**:
为每个拣货波次计算路径质量得分（0-100分）。

**评分公式**:
```
路径质量得分 = 基础分(40分)
             + 距离效率分(25分)
             + 重访惩罚分(25分)
             + 时间效率分(10分)

1. 距离效率分 = min(实际距离/理论最优距离, 1.0) × 25
2. 重访惩罚分 = 25 - (Aisle_Revisit×5 + Shelf_Revisit×2 + Slot_Revisit×1)
3. 时间效率分 = min(实际时间/标准时间, 1.0) × 10
```

**应用场景**:
- 每日路径质量排行榜（激励拣货员）
- 路径算法版本A/B测试对比
- KPI考核依据

---

## 🔧 P1需求：智能路径优化

### 需求3.1: 路径预优化引擎
**需求描述**:
在生成拣货任务时，WMS自动优化拣货顺序。

**优化策略**:
```
策略1: S型路径（推荐用于单通道密集拣货）
  - 在通道内按蛇形路线行走
  - 避免同通道往返

策略2: 最大间隙法（推荐用于跨通道拣货）
  - 将仓库划分为区域
  - 按区域分批拣货，减少跨区移动

策略3: TSP优化（适用于订单<50单）
  - 使用遗传算法求解最短路径
  - 实时计算，500ms内返回结果

策略4: 动态路径（适用于实时订单）
  - 根据当前位置动态调整下一目标
  - 考虑货位拥堵情况
```

**WMS界面配置**:
```
路径策略配置：
┌─────────────────────────────────────┐
│ 默认策略: [下拉选择]                  │
│  ○ S型路径                           │
│  ● 最大间隙法（当前）                 │
│  ○ TSP优化                           │
│  ○ 动态路径                          │
│                                     │
│ 高级设置:                            │
│  □ 优先高频SKU                       │
│  □ 避免拥堵货位                      │
│  ☑ 启用Aisle重访检测                 │
│  ☑ 自动合并相邻货位                  │
│                                     │
│ [保存配置]  [恢复默认]               │
└─────────────────────────────────────┘
```

---

### 需求3.2: 订单智能分批
**需求描述**:
WMS在波次生成时，智能分批订单以减少路径交叉。

**分批算法**:
```python
# 伪代码
def batch_orders(orders):
    """
    根据订单货位分布进行聚类分批
    """
    # 1. 按主通道分组
    groups = cluster_by_aisle(orders)

    # 2. 检查每组是否超过容量
    for group in groups:
        if group.volume > cart_capacity:
            # 按货架细分
            group = split_by_shelf(group)

    # 3. 计算每批次的路径复杂度
    for batch in batches:
        batch.complexity_score = calculate_revisit_risk(batch)

    # 4. 如果复杂度过高，重新分批
    return optimize_batches(batches)
```

**预期效果**:
- Aisle Revisit减少 60%
- 平均路径距离减少 25%

---

## 📈 P2需求：数据分析与优化建议

### 需求4.1: 货位热力分析
**需求描述**:
分析哪些货位被高频访问，建议货位优化方案。

**功能要点**:
```
1. 热力图展示：
   - 红色区域：高频访问（访问次数前10%）
   - 黄色区域：中频访问
   - 蓝色区域：低频访问

2. 优化建议自动生成：
   "SKU_12345访问频率排名第2，建议从C区迁移至A区黄金货位"
   "预计可节省路径距离：15m/单，月节省成本：XXX元"

3. ABC分类管理：
   - A类SKU（高频）：放置在易取位置
   - B类SKU（中频）：常规位置
   - C类SKU（低频）：远端位置
```

---

### 需求4.2: 路径回放与调试工具
**需求描述**:
WMS后台提供路径回放功能，用于分析问题波次。

**功能界面**:
```
┌─────────────────────────────────────────────────┐
│ 波次路径回放: W20251203001                       │
├─────────────────────────────────────────────────┤
│                                                 │
│   [仓库地图可视化]                               │
│   ├─ 路径轨迹（蓝线）                            │
│   ├─ 重访位置（红色标记）                         │
│   └─ 优化建议路径（绿色虚线）                     │
│                                                 │
├─────────────────────────────────────────────────┤
│ 时间轴:  [▶播放] [⏸暂停] [⏹停止]                 │
│ ━━━━━━━●━━━━━━━━━━━━━━━━━ 45%                  │
│                                                 │
│ 当前位置: Aisle_A, Shelf_03, Loc_A0301          │
│ 异常提示: ⚠️ 该通道已访问过，建议优化              │
├─────────────────────────────────────────────────┤
│ 优化建议:                                        │
│ 1. 将 Loc_A0305 提前至第3步拣货，减少1次重访      │
│ 2. 将 Aisle_C 的订单合并到下一波次               │
│                                                 │
│ [导出分析报告] [应用优化方案]                     │
└─────────────────────────────────────────────────┘
```

---

## 🔗 数据集成需求

### 5.1 需要WMS提供的数据字段
为了准确分析，需要在现有数据基础上补充：

```sql
-- 拣货明细表增强字段
ALTER TABLE picking_detail ADD COLUMN (
  pick_sequence INT,           -- 拣货顺序号
  actual_pick_time TIMESTAMP,  -- 实际拣货时间戳
  distance_to_next DECIMAL,    -- 到下一位置的距离
  aisle_code VARCHAR(10),      -- 通道编码
  shelf_code VARCHAR(10),      -- 货架编码
  zone_code VARCHAR(10),       -- 区域编码
  picker_id VARCHAR(20),       -- 拣货员ID
  cart_load_weight DECIMAL,    -- 当前载重
  is_revisit BOOLEAN           -- 是否重访标记
);

-- 新增：路径质量评估表
CREATE TABLE path_quality_log (
  id BIGINT PRIMARY KEY,
  wave_id VARCHAR(50),
  quality_score INT,
  aisle_revisit_count INT,
  shelf_revisit_count INT,
  slot_revisit_count INT,
  total_distance DECIMAL,
  optimal_distance DECIMAL,
  efficiency_ratio DECIMAL,
  created_at TIMESTAMP,
  alerts JSON
);
```

---

### 5.2 实时数据推送
建议WMS开通实时数据流：

```
推送方式: Kafka / RabbitMQ / WebSocket
推送频率: 每完成一个拣货单实时推送
数据格式: JSON

示例消息：
{
  "eventType": "PICK_COMPLETED",
  "timestamp": "2025-12-03T10:30:45.123Z",
  "waveId": "W20251203001",
  "pickerId": "P001",
  "location": "A0301",
  "sku": "SKU12345",
  "sequence": 15,
  "totalSequence": 48,
  "distanceFromLast": 12.5,
  "isRevisit": false,
  "currentCartWeight": 45.6
}
```

---

## 📅 实施路线图

### Phase 1: 数据监控（2周）
- [ ] Week 1: 增加路径质量评分API
- [ ] Week 2: 实时监控看板开发

### Phase 2: 告警系统（2周）
- [ ] Week 3: 异常检测规则引擎
- [ ] Week 4: 告警通知集成

### Phase 3: 路径优化（4周）
- [ ] Week 5-6: 路径优化算法开发
- [ ] Week 7: A/B测试验证
- [ ] Week 8: 全量上线

### Phase 4: 智能分批（4周）
- [ ] Week 9-10: 订单聚类算法
- [ ] Week 11: 分批策略调优
- [ ] Week 12: 性能优化

---

## 🎯 成功指标（KPI）

| 指标 | 当前值 | 目标值 | 评估周期 |
|-----|-------|--------|---------|
| Aisle Revisit平均次数 | ___ | <1次/波次 | 月度 |
| 路径效率（距离） | ___% | >85% | 月度 |
| 拣货速度 | ___ units/min | +15% | 月度 |
| 异常波次占比 | ___% | <10% | 周度 |
| 路径质量平均分 | ___ | >80分 | 日度 |

---

## 💡 快速见效方案（Quick Win）

如果WMS团队资源有限，建议优先实施：

### 🚀 方案A：规则引擎（开发周期2周）
不改动核心算法，增加路径验证规则：
```
规则1: 同通道订单必须合并处理
规则2: 禁止通道往返（除非载重超限）
规则3: 拣货顺序必须按货位序号排序
```

### 🚀 方案B：拣货员培训（立即实施）
基于当前分析结果，制定拣货SOP：
```
1. 严格按照WMS推荐顺序拣货
2. 发现路径异常时上报
3. 定期路径质量排名公示
```

---

## 📞 联系方式
**需求提出人**: [你的名字]
**部门**: [你的部门]
**日期**: 2025-12-03
**邮箱**: [你的邮箱]

**附件**:
1. [problem_assessment_template.md] - 问题评估报告
2. [当前路径分析数据.xlsx]
3. [典型异常波次回放视频]
